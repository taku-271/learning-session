# AWS S3

## 1. AWS S3とは何か？

### 基本的な定義
- **Amazon Simple Storage Service (S3)** は、AWSが提供するクラウドストレージサービス
- **オブジェクトストレージ** として設計されており、ファイルやデータを安全に保存・管理できる
- 世界中のどこからでもアクセス可能で、**無制限の容量**を持つ

### 身近な例で理解する
- **Googleドライブ**や**Dropbox**のような個人向けクラウドストレージの企業版
- ただし、S3はプログラムから操作することを前提とした設計
- Webサイトの画像、動画、文書ファイルなど、あらゆるデータを保存可能

## 2. S3の基本概念

### バケット（Bucket）
- データを保存する**コンテナ**のようなもの
- **フォルダ**のようなイメージだが、実際は階層構造ではない
- バケット名は**全世界で一意**である必要がある
- 例：`my-company-images`、`user-documents-2024`

### オブジェクト（Object）
- バケットに保存される**個々のファイル**
- 画像、動画、文書、プログラムファイルなど何でも保存可能
- 各オブジェクトには**キー（Key）**という名前が付く
- 例：`photos/vacation/beach.jpg`、`documents/report.pdf`

### キー（Key）
- オブジェクトの**識別子**（ファイル名のようなもの）
- スラッシュ（/）を使って階層構造のように見せることができる
- 例：`images/2024/01/photo001.jpg`

## 3. S3の主要な特徴

### 高い耐久性（Durability）
- **99.999999999%（イレブンナイン）**の耐久性
- データが失われる可能性が極めて低い
- 複数の場所に自動的にデータをコピーして保存

### 高い可用性（Availability）
- **99.9%**の可用性を保証
- システムがダウンしてもデータにアクセスできる

### スケーラビリティ
- 容量制限なし（理論上無制限）
- アクセス数が増えても自動的にスケールアウト

### セキュリティ
- **暗号化**機能が標準で利用可能
- **アクセス制御**により、誰がどのデータにアクセスできるかを細かく設定

## 4. ストレージクラス（料金体系）

### S3 Standard（標準）
- **頻繁にアクセスするデータ**向け
- 最も高速だが、料金も最も高い
- 用途：Webサイトの画像、アプリケーションのデータ

### S3 Standard-IA（Infrequent Access）
- **月に1回程度アクセスするデータ**向け
- 保存料金は安いが、アクセス時に料金が発生
- 用途：バックアップファイル、古いログファイル

### S3 Glacierファミリー（長期保存・アーカイブ用）

S3 Glacierには3つのストレージクラスがあり、アクセス頻度と取得時間に応じて選択できます：

#### S3 Glacier Instant Retrieval（即座取得）
- **最小保存期間**: 90日
- **推奨アクセス頻度**: 四半期に1回
- **取得時間**: ミリ秒（リアルタイムアクセス）
- **用途**: 画像ホスティング、ファイル共有、医療記録など、パフォーマンスが重要な長期保存データ

#### S3 Glacier Flexible Retrieval（柔軟取得）
- **最小保存期間**: 90日
- **推奨アクセス頻度**: 年に1〜2回
- **取得時間**: 数分〜12時間（復元リクエスト必要）
- **取得オプション**:
  - **Expedited（高速）**: 1〜5分
  - **Standard（標準）**: 3〜5時間
  - **Bulk（バルク）**: 5〜12時間（無料）
- **用途**: バックアップ、災害復旧

#### S3 Glacier Deep Archive（深いアーカイブ）
- **最小保存期間**: 180日
- **推奨アクセス頻度**: 年に1回未満
- **取得時間**: 9〜48時間（復元リクエスト必要）
- **取得オプション**:
  - **Standard（標準）**: 12時間以内
  - **Bulk（バルク）**: 48時間以内（より低コスト）
- **用途**: 長期保存、コンプライアンス要件（AWSで最も低コスト）

### S3 Intelligent-Tiering（自動最適化）

**アクセスパターンが不明なデータ**向けの自動最適化ストレージクラスです。アクセスパターンを監視し、自動的に最適な層に移動してコストを削減します。

#### 自動層（追加料金なし）
1. **Frequent Access tier（頻繁アクセス層）**
   - デフォルトの開始層
   - 低レイテンシー、高スループット

2. **Infrequent Access tier（低頻度アクセス層）**
   - 30日間アクセスなしで自動移動
   - 低レイテンシー、高スループット

3. **Archive Instant Access tier（アーカイブ即座アクセス層）**
   - 90日間アクセスなしで自動移動
   - ミリ秒アクセス、高スループット

#### オプション層（アクティベーション必要）
4. **Archive Access tier（アーカイブアクセス層）**
   - 90日間アクセスなし（最大730日まで設定可能）
   - 取得時間：3〜5時間
   - S3 Glacier Flexible Retrievalと同等

5. **Deep Archive Access tier（深いアーカイブアクセス層）**
   - 180日間アクセスなし（最大730日まで設定可能）
   - 取得時間：12時間以内
   - S3 Glacier Deep Archiveと同等

#### 重要なポイント
- **最小オブジェクトサイズ**: 128KB未満は監視対象外（常にFrequent Access tier）
- **自動移動**: アクセスがあると自動的により頻繁なアクセス層に移動
- **月額監視料金**: オブジェクトあたりの小額な監視・自動化料金が発生

### ストレージクラス選択の指針

| ストレージクラス | アクセス頻度 | 取得時間 | 最小保存期間 | 主な用途 |
|------------------|--------------|----------|--------------|----------|
| S3 Standard | 頻繁 | ミリ秒 | なし | アクティブデータ |
| S3 Standard-IA | 月1回程度 | ミリ秒 | 30日 | バックアップ |
| S3 Glacier Instant Retrieval | 四半期1回 | ミリ秒 | 90日 | 長期保存（即座アクセス） |
| S3 Glacier Flexible Retrieval | 年1〜2回 | 分〜時間 | 90日 | アーカイブ |
| S3 Glacier Deep Archive | 年1回未満 | 時間 | 180日 | 長期アーカイブ |
| S3 Intelligent-Tiering | 不明・変動 | 自動最適化 | なし | パターン不明データ |

## 5. 実際の使用例

### Webサイトでの利用
```
例：ECサイトの商品画像
- バケット：my-shop-images
- オブジェクト：products/shoes/sneaker-001.jpg
- 用途：商品ページで画像を表示
```

### アプリケーションでの利用
```
例：ユーザーがアップロードしたファイル
- バケット：user-uploads-app
- オブジェクト：users/12345/profile-photo.png
- 用途：プロフィール画像の保存
```

### バックアップでの利用
```
例：データベースのバックアップ
- バケット：database-backups
- オブジェクト：mysql/2024/01/15/backup.sql
- 用途：災害時のデータ復旧
```

## 6. 料金体系

### 主な料金要素
1. **ストレージ料金**：保存しているデータ量に応じて課金
2. **リクエスト料金**：データの読み書き回数に応じて課金
3. **データ転送料金**：インターネットへのデータ送信量に応じて課金

### 料金の目安（東京リージョン）
- **S3 Standard**：約0.025USD/GB/月
- **S3 Standard-IA**：約0.019USD/GB/月
- **S3 Glacier**：約0.005USD/GB/月

### 無料利用枠
- 新規ユーザーは**12ヶ月間**、月5GBまで無料
- 月20,000回のGETリクエスト、2,000回のPUTリクエストが無料

## 7. セキュリティのベストプラクティス

### アクセス制御
- **IAM（Identity and Access Management）**でユーザー権限を管理
- **バケットポリシー**で細かいアクセス制御を設定
- **パブリックアクセスのブロック**を有効にする

### 暗号化
- **保存時の暗号化**：S3に保存されるデータを暗号化
- **転送時の暗号化**：HTTPS通信でデータを保護

### 監査・ログ
- **CloudTrail**でAPI呼び出しをログ記録
- **アクセスログ**でファイルアクセスを監視

## 8. 開発者向けの基本操作

### AWS CLI（コマンドライン）での操作
```bash
# バケット作成
aws s3 mb s3://my-new-bucket

# ファイルアップロード
aws s3 cp local-file.txt s3://my-bucket/

# ファイル一覧表示
aws s3 ls s3://my-bucket/

# ファイルダウンロード
aws s3 cp s3://my-bucket/file.txt ./
```

### プログラムでの操作（Python例）
```python
import boto3

# S3クライアント作成
s3 = boto3.client('s3')

# ファイルアップロード
s3.upload_file('local-file.txt', 'my-bucket', 'uploaded-file.txt')

# ファイルダウンロード
s3.download_file('my-bucket', 'uploaded-file.txt', 'downloaded-file.txt')
```

## まとめ

AWS S3は現代のクラウドアプリケーション開発において必須のサービスです。基本概念を理解し、適切なセキュリティ設定を行うことで、安全で効率的なデータ管理が可能になります。まずは無料利用枠を使って実際に触ってみることをお勧めします。